[{"type":"text","text":"## Add filter-only query path to searchUserPrompts method\n*Source: claude-mem://observation/10755*\n\n**Method accepts undefined query and handles dual-path logic with separate parameter arrays for clarity.**\n\nThe searchUserPrompts method has been enhanced with filter-only query support, completing the pattern established in searchObservations and searchSessions. The method signature now accepts optional query parameter. The implementation builds base filter conditions once for project and date range filters, then diverges into two paths. The filter-only path (when query is undefined) validates that at least some filters exist, then queries the user_prompts table directly with a WHERE clause, joining sdk_sessions for project filtering. The FTS5 path rebuilds filter conditions into a separate ftsParams array to avoid parameter ordering conflicts between the two paths. This dual-path approach enables both semantic/keyword search via FTS5 and pure metadata filtering via direct SQLite queries, completing the architectural pattern across all three search methods.\n\n---\nType: feature | Facts: searchUserPrompts signature changed to accept `query: string | undefined` at line 541; Filter conditions built once and shared between filter-only and FTS5 paths at lines 546-563; Filter-only path at lines 566-588 validates filters exist and queries user_prompts table directly; FTS5 path at lines 591-616 rebuilds filter conditions with separate ftsParams array to avoid parameter conflicts; Filter-only path joins sdk_sessions table for project filtering support; Documentation updated to clarify dual-mode operation matching searchObservations and searchSessions patterns | Concepts: what-changed, how-it-works, pattern, gotcha | Files: src/services/sqlite/SessionSearch.ts\n\n---\nDate: 11/17/2025, 11:50:08 PM\n\n---\n\n## searchUserPrompts Uses Custom ORDER BY Logic Instead of buildOrderClause\n*Source: claude-mem://observation/10754*\n\n**Unlike searchObservations, searchUserPrompts implements inline ORDER BY construction with hard-coded table aliases rather than using buildOrderClause helper.**\n\nThe searchUserPrompts method implements its ORDER BY logic inline rather than using the buildOrderClause helper method used by searchObservations and searchSessions. Lines 619-623 show a ternary expression that constructs the ORDER BY clause with hard-coded references to user_prompts_fts.rank for relevance ordering and up.created_at_epoch for date-based sorting. The main SQL query joins three tables: user_prompts, user_prompts_fts, and sdk_sessions, with the sdk_sessions join enabling project-based filtering. When implementing the filter-only path for this method, the code will need to construct a query that joins only user_prompts and sdk_sessions (skipping user_prompts_fts), and the ORDER BY logic will need to handle the absence of FTS5 rank data, defaulting to date-based ordering when query is undefined.\n\n---\nType: discovery | Facts: searchUserPrompts constructs ORDER BY clause inline at lines 619-623 instead of calling buildOrderClause; The inline ORDER BY uses hard-coded table alias user_prompts_fts.rank for relevance ordering; Date-based ordering uses up.created_at_epoch for both ascending and descending sorts; The SQL query joins user_prompts, user_prompts_fts, and sdk_sessions tables; searchUserPrompts will need filter-only path to query user_prompts without user_prompts_fts JOIN when query is undefined | Concepts: how-it-works, pattern | Files: src/services/sqlite/SessionSearch.ts\n\n---\nDate: 11/17/2025, 11:50:07 PM\n\n---\n\n## User Prompts Search Joins Three Tables for Filtering\n*Source: claude-mem://observation/10753*\n\n**searchUserPrompts method joins user_prompts, user_prompts_fts, and sdk_sessions tables to enable project-based filtering.**\n\nThe searchUserPrompts method demonstrates a more complex query structure than searchObservations or searchSessions due to the need for project filtering. Since user_prompts don't directly store project information, the method joins with the sdk_sessions table using claude_session_id as the key, which allows filtering by the project field from sdk_sessions. The query structure follows the same FTS5 pattern seen in other search methods: it joins the base table (user_prompts) with its FTS5 virtual table (user_prompts_fts) via rowid, uses the MATCH operator for full-text search, and orders by rank for relevance-based results. The default limit is set to 20 rather than 50, suggesting user prompts are typically returned in smaller batches. Like the other search methods, rank values are normalized to a 0-1 score scale where higher values indicate better matches, inverting FTS5's native lower-is-better ranking.\n\n---\nType: discovery | Facts: searchUserPrompts method joins three tables: user_prompts, user_prompts_fts, and sdk_sessions; sdk_sessions table joined via claude_session_id to enable project filtering on user prompts; user_prompts table aliased as 'up' and uses MATCH operator on user_prompts_fts virtual table; Default limit for user prompts is 20, compared to 50 for observations and sessions; Method supports dateRange filtering using created_at_epoch column from user_prompts table; Rank normalization converts FTS5 rank scores to 0-1 scale where higher values indicate better matches | Concepts: how-it-works, pattern | Files: /Users/alexnewman/Scripts/claude-mem/src/services/sqlite/SessionSearch.ts\n\n---\nDate: 11/17/2025, 11:49:42 PM\n\n---\n\n## Add filter-only query path to searchSessions method\n*Source: claude-mem://observation/10751*\n\n**Method now accepts undefined query and queries session_summaries table directly for metadata-only filtering.**\n\nThe searchSessions method in SessionSearch.ts has been enhanced to support filter-only queries without query text. The method signature now accepts `query: string | undefined`, enabling two distinct code paths. When query is undefined, a new filter-only path (lines 331-352) bypasses FTS5 entirely and queries the session_summaries table directly using metadata filters like project or date range. This path validates that at least some filters exist, throwing an error if both query and filters are missing. When query text is provided, the existing FTS5 search path executes as before. This dual-mode approach allows the system to handle both semantic/keyword search and pure metadata filtering, addressing the architectural requirement that filter-only queries skip text search mechanisms.\n\n---\nType: feature | Facts: searchSessions signature changed to accept `query: string | undefined` at line 327; New filter-only path added at lines 331-352 that bypasses FTS5 when query is undefined; Filter-only path throws error if neither query nor filters provided at line 336; Direct SQLite query on session_summaries table uses WHERE clause built from metadata filters; FTS5 path at line 355 only executes when query text exists; Documentation updated to clarify dual-mode operation: FTS5 fallback vs filter-only direct query | Concepts: what-changed, how-it-works, pattern | Files: src/services/sqlite/SessionSearch.ts\n\n---\nDate: 11/17/2025, 11:49:23 PM\n\n---\n\n## SessionSearch Methods Use FTS5 for Full-Text Search\n*Source: claude-mem://observation/10750*\n\n**Observed searchSessions method implementation showing FTS5 virtual table usage with rank-based relevance scoring.**\n\nThe SessionSearch.searchSessions method demonstrates the FTS5 full-text search implementation for session summaries. The method builds a SQL query that joins the session_summaries table with its corresponding session_summaries_fts virtual table, using the MATCH operator for full-text search. The query construction includes filter support (excluding type filters which aren't applicable to sessions), and adjusts column names to account for session_summaries using files_edited instead of files_modified. When orderBy is set to 'relevance', the query orders by session_summaries_fts.rank in ascending order, where lower rank values indicate better matches (FTS5 convention). The method then normalizes these ranks into 0-1 scores where higher is better. This pattern is consistent with searchObservations and searchUserPrompts methods, all using the same FTS5-based approach as a fallback when ChromaDB semantic search is unavailable.\n\n---\nType: discovery | Facts: searchSessions method in SessionSearch.ts performs FTS5 full-text search on session summaries; Method queries session_summaries_fts virtual table and joins with session_summaries table; FTS5 relevance ranking uses rank ASC ordering where lower rank values indicate better matches; Method supports three order modes: relevance (FTS5 rank), date_asc, and date_desc; Files_modified column name is replaced with files_edited for session_summaries table compatibility; Method uses escapeFTS5_fallback_when_chroma_unavailable to sanitize query input | Concepts: how-it-works, pattern | Files: /Users/alexnewman/Scripts/claude-mem/src/services/sqlite/SessionSearch.ts\n\n---\nDate: 11/17/2025, 11:49:09 PM"}]